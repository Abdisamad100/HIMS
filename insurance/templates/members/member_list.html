{% extends 'base.html' %}
{% block content %}
<div class="container mt-5">
  <h3 class="mb-4">Registered Members</h3>
  <a href="{% url 'register_member' %}" class="btn btn-success mb-3">+ Add Member</a>

  <div class="card shadow-sm">
    <div class="card-body p-0">
      <table class="table table-bordered table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Policies</th>
            <th>Phone</th>
            <th>Registered By</th>
            <th>Joined</th>
          </tr>
        </thead>
        <tbody>
          {% for member in members %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ member.user.get_full_name|default:member.user.username }}</td>

            <!-- List all policies for this member -->
            <td>
              {% if member.policies.all %}
                {% for mp in member.policies.all %}
                  <span class="badge bg-primary mb-1">
                    {{ mp.policy.name }} ({{ mp.member_policy_number }})
                  </span><br>
                {% endfor %}
              {% else %}
                <span class="text-muted">No policy assigned</span>
              {% endif %}
            </td>

            <td>{{ member.phone }}</td>
            <td>{{ member.registered_by.username }}</td>
            <td>{{ member.created_at|date:"Y-m-d" }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-center py-4 text-muted">
              No members registered yet.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
